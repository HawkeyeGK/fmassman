@using fmassman.Shared

<style>
    /* Suppress default Bootstrap focus ring to prevent "last clicked" glow */
    .btn-check:focus + .btn, .btn:focus {
        box-shadow: none !important;
    }
</style>

<div class="d-flex flex-wrap gap-2 mb-3">
    @if (AllTags != null)
    {
        @foreach (var tag in AllTags)
        {
            var isSelected = SelectedTagIds.Contains(tag.Id);
            <button type="button" 
                    class="btn btn-sm rounded-pill @GetButtonClass(tag, isSelected)" 
                    @onclick="() => ToggleTag(tag.Id)">
                @tag.Name
                @if (isSelected)
                {
                    <i class="bi bi-check ms-1"></i>
                }
            </button>
        }
    }
</div>

@code {
    [Parameter]
    public List<TagDefinition> AllTags { get; set; } = new();

    [Parameter]
    public List<string> SelectedTagIds { get; set; } = new();

    [Parameter]
    public EventCallback<List<string>> SelectedTagIdsChanged { get; set; }

    [Parameter]
    public EventCallback OnChange { get; set; }

    private async Task ToggleTag(string tagId)
    {
        if (SelectedTagIds.Contains(tagId))
        {
            SelectedTagIds.Remove(tagId);
        }
        else
        {
            SelectedTagIds.Add(tagId);
        }

        await SelectedTagIdsChanged.InvokeAsync(SelectedTagIds);
        await OnChange.InvokeAsync();
    }

    private string GetButtonClass(TagDefinition tag, bool isSelected)
    {
        // Determine base color type
        var colorType = "primary"; // Default/Rostered
        if (tag.IsArchived) colorType = "danger";
        else if (!tag.IsRostered) colorType = "info";

        if (isSelected)
        {
            // Selected: Solid color, Bold, Shadow (Glow)
            // Note: btn-info usually has black text, we might want to force white if it matches the others, 
            // but let's stick to default bootstrap contrast for now.
            return $"btn-{colorType} fw-bold shadow border-{colorType}";
        }
        else
        {
            // Unselected: Outline color, Muted opacity
            // This ensures color coding is visible before selection
            return $"btn-outline-{colorType}";
        }
    }
}
